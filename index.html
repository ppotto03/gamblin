<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280">
    <title> SUPER 9 BET | PREMIUM CASINO </title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --point-gold: #ffcc00; --bg-dark: #0f0f0f; --panel-bg: #1a1a1a; --neon-blue: #0066ff; --neon-red: #ff0000; }
        body { background-color: var(--bg-dark); color: #fff; font-family: 'Noto Sans KR', sans-serif; margin: 0; min-width: 1280px; }
        
        /* ê²°ê³¼ íŒì—… */
        #resultPopup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; background: rgba(0,0,0,0.95); border: 4px solid var(--point-gold); padding: 50px; border-radius: 30px; text-align: center; box-shadow: 0 0 100px rgba(255, 204, 0, 0.5); }
        
        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .top-nav { background: linear-gradient(90deg, #0d3b14, #051a08); height: 80px; display: flex; justify-content: space-between; align-items: center; padding: 0 40px; border-bottom: 3px solid #ffcc00; box-sizing: border-box; }
        .logo { font-size: 32px; font-weight: 900; color: #fff; font-style: italic; text-shadow: 3px 3px 0px #000; cursor: pointer; }
        .nav-right { display: flex; align-items: center; gap: 15px; }
        .asset-box { background: #000; padding: 10px 20px; border-radius: 8px; border: 2px solid gold; color: #ffcc00; font-weight: 900; font-size: 24px; }

        /* ë ˆì´ì•„ì›ƒ */
        .main-wrapper { display: flex; height: calc(100vh - 80px); }
        .sidebar { width: 240px; background: #111; border-right: 1px solid #333; display: flex; flex-direction: column; padding-top: 20px; }
        .menu-item { padding: 20px; cursor: pointer; color: #aaa; font-weight: 700; font-size: 18px; border-left: 6px solid transparent; transition: 0.3s; }
        .menu-active { background: #222; color: #ffff00 !important; border-left: 6px solid #ffff00 !important; }

        .content { flex: 1; padding: 30px; overflow-y: auto; background: #050505; }

        /* ğŸ“¢ ê´‘ê³  ì„¹ì…˜ (ì´ë¯¸ì§€ ê¸°ë°˜ ëŒ€í­ ì¶”ê°€) */
        .ad-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .ad-card { height: 80px; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: 900; border-radius: 10px; border: 2px solid #fff; text-shadow: 2px 2px 4px #000; animation: flash 0.5s infinite alternate; }
        
        @keyframes flash { from { opacity: 1; } to { opacity: 0.7; } }

        .marquee-container { background: #000; border: 2px solid gold; padding: 15px; border-radius: 10px; margin-bottom: 25px; overflow: hidden; position: relative; }
        .marquee-text { display: inline-block; white-space: nowrap; font-size: 24px; font-weight: 900; color: #fff; animation: marquee 15s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 30px; }
        .info-box { background: #1a1a1a; border: 1px solid #333; padding: 30px; border-radius: 15px; text-align: center; }
        .info-tag { display: inline-block; padding: 4px 12px; border-radius: 4px; font-weight: 900; margin-bottom: 10px; }

        /* ğŸ° ìŠ¬ë¡¯ - ì´ëª¨ì§€ ëŒ€í˜•í™” */
        .slot-machine { background: #222; padding: 40px; border-radius: 20px; border: 5px solid gold; display: inline-block; }
        .reel-box { display: flex; gap: 20px; margin-bottom: 30px; }
        .reel { width: 140px; height: 180px; background: #fff; border-radius: 15px; font-size: 90px; display: flex; align-items: center; justify-content: center; color: #000; border: 5px solid #444; }
        .reel.spinning { animation: reel-move 0.1s infinite; }
        @keyframes reel-move { 0% { transform: translateY(-5px); } 100% { transform: translateY(5px); } }

        /* ğŸƒ ë°”ì¹´ë¼ - ì‚¬ì‹¤ì ì¸ í…Œì´ë¸” */
        .bac-table { background: radial-gradient(circle, #006633, #00331a); border: 12px solid #5d4037; border-radius: 150px; padding: 60px; display: flex; justify-content: space-around; align-items: center; box-shadow: inset 0 0 50px #000; }
        .card { width: 100px; height: 145px; background: #fff; border-radius: 8px; border: 2px solid #999; display: flex; align-items: center; justify-content: center; font-size: 45px; font-weight: 900; color: #000; transform: rotateY(90deg); transition: 0.5s; }
        .card.show { transform: rotateY(0deg); }

        /* ğŸŒ ë‹¬íŒ½ì´ - íŠ¸ë™ ì‚¬ì‹¤í™” */
        .race-track { background: #222; border: 3px solid #444; border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .lane { height: 70px; border-bottom: 1px dashed #555; position: relative; display: flex; align-items: center; }
        .finish-line { position: absolute; right: 60px; top: 0; bottom: 0; width: 10px; background: repeating-linear-gradient(0deg, #fff, #fff 10px, #000 10px, #000 20px); }
        .snail { position: absolute; left: 10px; font-size: 50px; transition: left 0.1s linear; z-index: 10; }

        .btn-play { background: linear-gradient(180deg, #ffcc00, #b8860b); color: #000; border: none; padding: 15px 40px; font-weight: 900; font-size: 20px; border-radius: 10px; cursor: pointer; box-shadow: 0 6px 0 #7b6500; }
        .btn-play:active { transform: translateY(3px); box-shadow: 0 3px 0 #7b6500; }
    </style>
</head>
<body>
    <div id="resultPopup">
        <h1 id="popTitle" style="font-size:60px; margin:0; color: #ffcc00;">BIG WIN!</h1>
        <h2 id="popAmount" style="font-size:40px; color:#fff;">+ 0 KRW</h2>
        <button class="btn-play" onclick="closePopup()">í™•ì¸</button>
    </div>

    <div class="top-nav">
        <div class="logo" onclick="showView('lobby')">S SUPER 9 BET</div>
        <div class="nav-right">
            <div class="asset-box">â‚© <span id="assetVal">0</span></div>
            <div id="userNick" style="font-weight:900; font-size:18px;">ë¡œë”© ì¤‘...</div>
            <button onclick="handleLogout()" style="background:red; color:#fff; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div class="main-wrapper">
        <div class="sidebar">
            <div id="m-lobby" class="menu-item menu-active" onclick="showView('lobby')">ë©”ì¸ ë¡œë¹„</div>
            <div id="m-slotView" class="menu-item" onclick="showView('slotView')">ğŸ° 777ìŠ¬ë¡¯</div>
            <div id="m-bacView" class="menu-item" onclick="showView('bacView')">ğŸƒ ë°”ì¹´ë¼</div>
            <div id="m-snailView" class="menu-item" onclick="showView('snailView')">ğŸŒ ë‹¬íŒ½ì´ ë ˆì´ìŠ¤</div>
        </div>

        <div class="content">
            <div id="lobby" class="view active-view">
                <div class="ad-grid">
                    <div class="ad-card" style="background:#ff0000; border-color:#ffff00;">ğŸ”¥ ë³´ì¦ì—…ì²´ 10ë…„ì°¨ ë©”ì´ì € ğŸ”¥</div>
                    <div class="ad-card" style="background:#0000ff; border-color:#00ffff;">ğŸ’ ê°œì¸ ì¸ì¦ í•„ìš” ì—†ëŠ” ê°„í¸ ê°€ì… ğŸ’</div>
                </div>

                <div style="background:#151515; padding:60px; border-radius:20px; text-align:center; border:2px solid #333; margin-bottom:25px;">
                    <h1 style="font-size:70px; color:#ffcc00; margin:0; letter-spacing:5px;">SUPER 000 BET CASINO</h1>
                    <p style="font-size:24px; color:#ccc;">NO ë² íŒ…í•œë„! ë¨¹íŠ€ ì—†ëŠ” ê³ ë°°ë‹¹ ê³ ìˆ˜ìµ ì•ˆì „ ì‚¬ì´íŠ¸</p>
                </div>

                <div class="marquee-container">
                    <div class="marquee-text">âš¡ ì—…ê³„ ìµœê³  ë°°ë‹¹ ë³´ì¥! âš¡ LTEê¸‰ ê´‘ì† í¬ì¸íŠ¸ ì „í™˜ ì„œë¹„ìŠ¤ âš¡ ì•ˆì „í•˜ê³  ê³µì •í•œ ê²Œì„ í™˜ê²½ âš¡ ì‚¬ê³  ë°œìƒ ì‹œ 200% ë³´ìƒ ë³´ì¥! âš¡</div>
                </div>

                <div class="info-grid">
                    <div class="info-box">
                        <span class="info-tag" style="background:red;">HOT</span>
                        <h2>ì…ì¶œê¸ˆ 1ë¶„ ì»·</h2>
                        <p>ê¸°ë‹¤ë¦¼ ì—†ëŠ” ë¬´ì œí•œ í™˜ì „ ì„œë¹„ìŠ¤<br>ì—…ê³„ ìœ ì¼ ì‚¬ê³  ë°œìƒ ì‹œ 200% ë³´ìƒ</p>
                    </div>
                    <div class="info-box">
                        <span class="info-tag" style="background:gold; color:#000;">EVENT</span>
                        <h2>ì‹ ê·œ ì²«ì¶© 30%</h2>
                        <p>ê°€ì… í›„ ì²« ì¶©ì „ ì‹œ í¬ì¸íŠ¸ í­ê²©<br>ë§¤ì¼ë§¤ì¼ ìŸì•„ì§€ëŠ” ëŒë°œ ë³´ë„ˆìŠ¤</p>
                    </div>
                    <div class="info-box">
                        <span class="info-tag" style="background:blue;">RELIABLE</span>
                        <h2>í•´ì™¸ ì •ì‹ ë¼ì´ì„ ìŠ¤</h2>
                        <p>ì¡°ì‘ ì—†ëŠ” ê³µì •í•œ ê²Œì„ ì‹œìŠ¤í…œ<br>ì „ ì„¸ê³„ 1ìœ„ ì†Œí”„íŠ¸ì›¨ì–´ ê³µì‹ íŒŒíŠ¸ë„ˆ</p>
                    </div>
                </div>
            </div>

            <div id="slotView" class="view">
                <div style="text-align:center;">
                    <div class="slot-machine">
                        <div class="reel-box">
                            <div id="r1" class="reel">ğŸ°</div>
                            <div id="r2" class="reel">ğŸ°</div>
                            <div id="r3" class="reel">ğŸ°</div>
                        </div>
                        <input type="number" id="slotBet" style="width:250px; padding:15px; font-size:24px; background:#000; color:gold; border:2px solid #444; margin-bottom:20px;" value="10000"><br>
                        <button class="btn-play" onclick="playSlot()">SPIN!</button>
                    </div>
                </div>
            </div>

            <div id="bacView" class="view">
                <div class="bac-table">
                    <div style="text-align:center;">
                        <h2 style="color:#4facfe;">PLAYER</h2>
                        <div style="display:flex; gap:10px;"><div class="card" id="pC1"></div><div class="card" id="pC2"></div></div>
                    </div>
                    <h1 style="font-size:60px; color:gold;">VS</h1>
                    <div style="text-align:center;">
                        <h2 style="color:#ff5252;">BANKER</h2>
                        <div style="display:flex; gap:10px;"><div class="card" id="bC1"></div><div class="card" id="bC2"></div></div>
                    </div>
                </div>
                <div style="text-align:center; margin-top:30px;">
                    <input type="number" id="bacBet" style="padding:15px; font-size:20px; background:#000; color:gold; border:2px solid #444;" value="10000">
                    <button class="btn-play" style="background:#4facfe;" onclick="playBac('player')">PLAYER</button>
                    <button class="btn-play" style="background:#ff5252;" onclick="playBac('banker')">BANKER</button>
                </div>
            </div>

            <div id="snailView" class="view">
                <div class="race-track">
                    <div class="lane"><div class="finish-line"></div><div id="s0" class="snail">ğŸŒ</div></div>
                    <div class="lane"><div class="finish-line"></div><div id="s1" class="snail" style="filter:hue-rotate(100deg);">ğŸŒ</div></div>
                    <div class="lane"><div class="finish-line"></div><div id="s2" class="snail" style="filter:hue-rotate(250deg);">ğŸŒ</div></div>
                </div>
                <div style="text-align:center;">
                    <select id="snailPick" style="padding:15px; font-size:20px; background:#000; color:#fff;">
                        <option value="0">1ë²ˆ ë¹¨ê°• ë‹¬íŒ½ì´</option>
                        <option value="1">2ë²ˆ ì´ˆë¡ ë‹¬íŒ½ì´</option>
                        <option value="2">3ë²ˆ íŒŒë‘ ë‹¬íŒ½ì´</option>
                    </select>
                    <input type="number" id="snailBet" style="padding:15px; font-size:20px; background:#000; color:gold; border:2px solid #444;" value="10000">
                    <button class="btn-play" onclick="playSnail()">RACE!</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4", authDomain: "gambling-23339.firebaseapp.com", projectId: "gambling-23339", storageBucket: "gambling-23339.firebasestorage.app", messagingSenderId: "1031894079454", appId: "1:1031894079454:web:960ca0f1748493cdd9af4f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userObj = null, curBal = 0, isPlaying = false;

        onAuthStateChanged(auth, async (user) => {
            if(user) {
                userObj = user;
                const snap = await getDoc(doc(db, "users", user.uid));
                if(snap.exists()) {
                    const d = snap.data();
                    document.getElementById('userNick').innerText = d.nickname + "ë‹˜";
                    updateAsset(d.balance);
                }
            } else { location.href = "login.html"; }
        });

        function updateAsset(v) { curBal = v; document.getElementById('assetVal').innerText = v.toLocaleString(); }

        async function processResult(game, bet, profit) {
            await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit) });
            updateAsset(curBal + profit);
            await addDoc(collection(db, "history"), { uid: userObj.uid, game, bet, profit, time: new Date() });
        }

        // --- ìŠ¬ë¡¯ (ì´ëª¨í‹°ì½˜) ---
        window.playSlot = async () => {
            if(isPlaying) return;
            const bet = parseInt(document.getElementById('slotBet').value);
            if(bet > curBal || bet <= 0) return alert("ì”ì•¡ ë¶€ì¡±");

            isPlaying = true;
            const reels = [document.getElementById('r1'), document.getElementById('r2'), document.getElementById('r3')];
            reels.forEach(r => r.classList.add('spinning'));

            setTimeout(async () => {
                reels.forEach(r => r.classList.remove('spinning'));
                const items = ['ğŸ’','ğŸ','7ï¸âƒ£','ğŸ’','ğŸ€'];
                const r = [items[Math.floor(Math.random()*5)], items[Math.floor(Math.random()*5)], items[Math.floor(Math.random()*5)]];
                reels.forEach((el, i) => el.innerText = r[i]);

                let mul = 0;
                if(r[0] === r[1] && r[1] === r[2]) mul = 15;
                else if(r[0] === r[1] || r[1] === r[2] || r[0] === r[2]) mul = 2;

                const profit = (bet * mul) - bet;
                await processResult("ìŠ¬ë¡¯", bet, profit);
                showPopup(profit >= 0, profit);
                isPlaying = false;
            }, 1500);
        };

        // --- ë°”ì¹´ë¼ (ì¹´ë“œ ì—°ì¶œ) ---
        window.playBac = async (pick) => {
            const bet = parseInt(document.getElementById('bacBet').value);
            if(bet > curBal) return alert("ì”ì•¡ ë¶€ì¡±");

            const cards = [document.getElementById('pC1'), document.getElementById('pC2'), document.getElementById('bC1'), document.getElementById('bC2')];
            cards.forEach(c => { c.classList.remove('show'); c.innerText = ""; });

            setTimeout(() => {
                const v = [Math.floor(Math.random()*9)+1, Math.floor(Math.random()*9)+1, Math.floor(Math.random()*9)+1, Math.floor(Math.random()*9)+1];
                cards.forEach((c, i) => {
                    setTimeout(() => {
                        c.innerText = v[i];
                        c.classList.add('show');
                    }, i * 500);
                });

                setTimeout(async () => {
                    const pScore = (v[0]+v[1])%10, bScore = (v[2]+v[3])%10;
                    const win = pScore > bScore ? 'player' : 'banker';
                    const profit = (pick === win) ? bet : -bet;
                    await processResult("ë°”ì¹´ë¼", bet, profit);
                    showPopup(profit >= 0, profit);
                }, 2500);
            }, 100);
        };

        // --- ë‹¬íŒ½ì´ (ë ˆì´ìŠ¤ ì—°ì¶œ) ---
        window.playSnail = async () => {
            if(isPlaying) return;
            const bet = parseInt(document.getElementById('snailBet').value);
            const pick = parseInt(document.getElementById('snailPick').value);
            if(bet > curBal) return alert("ì”ì•¡ ë¶€ì¡±");

            isPlaying = true;
            let pos = [10, 10, 10];
            const snails = [document.getElementById('s0'), document.getElementById('s1'), document.getElementById('s2')];

            const timer = setInterval(async () => {
                for(let i=0; i<3; i++) {
                    pos[i] += Math.random() * 12;
                    snails[i].style.left = pos[i] + "px";
                    if(pos[i] >= 1150) {
                        clearInterval(timer);
                        const winner = pos.indexOf(Math.max(...pos));
                        const profit = (pick === winner) ? bet * 2 : -bet;
                        await processResult("ë‹¬íŒ½ì´", bet, profit);
                        showPopup(profit >= 0, profit);
                        isPlaying = false;
                        setTimeout(() => snails.forEach(s => s.style.left = "10px"), 2000);
                        break;
                    }
                }
            }, 50);
        };

        window.showView = (v) => {
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active-view'));
            document.querySelectorAll('.menu-item').forEach(e => e.classList.remove('menu-active'));
            document.getElementById(v).classList.add('active-view');
            document.getElementById('m-'+v).classList.add('menu-active');
        };

        window.showPopup = (win, am) => {
            document.getElementById('popTitle').innerText = win ? "BIG WIN!" : "LOSE";
            document.getElementById('popAmount').innerText = (am >= 0 ? "+" : "") + am.toLocaleString() + " KRW";
            document.getElementById('resultPopup').style.display = 'block';
        };
        window.closePopup = () => document.getElementById('resultPopup').style.display = 'none';
        window.handleLogout = () => signOut(auth).then(() => location.href="login.html");
    </script>
</body>
</html>