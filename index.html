<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280">
    <title> SUPER 9 BET CASINO | MANAGEMENT</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --point-gold: #eebb4d; --bg-dark: #0a0a0a; --panel-bg: #151515; --neon-red: #ff0000; --point-green: #2ecc71; }
        body { background-color: var(--bg-dark); color: #eee; font-family: 'Noto Sans KR', sans-serif; margin: 0; overflow-x: auto; min-width: 1280px; }
        
        /* íŒì—… ë””ìì¸ */
        #resultPopup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; background: rgba(0,0,0,0.9); border: 3px solid var(--point-gold); padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 0 50px gold; min-width: 320px; }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ & ì‚¬ì´ë“œë°” (ì›ë³¸ ìœ ì§€) */
        .top-nav { background: linear-gradient(180deg, #1b5e20, #0a2e10); height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; border-bottom: 2px solid #222; }
        .logo { font-size: 26px; font-weight: 900; color: #fff; font-style: italic; cursor: pointer; }
        .asset-box { background: #000; padding: 8px 15px; border-radius: 5px; border: 1px solid gold; color: gold; font-weight: 900; font-size: 20px; }
        
        .main-wrapper { display: flex; height: calc(100vh - 70px); }
        .sidebar { width: 220px; background: #0d0d0d; border-right: 1px solid #222; display: flex; flex-direction: column; }
        .menu-item { padding: 25px 20px; cursor: pointer; color: #888; font-weight: 700; border-left: 5px solid transparent; transition: 0.3s; }
        .menu-active { background: #1a1a1a; color: #ffff00 !important; border-left: 5px solid #ffff00 !important; font-weight: 900; }

        .content { flex: 1; padding: 30px; overflow-y: auto; background: #111; }

        /* ğŸ“¢ ì¶”ê°€ëœ ê´‘ê³  ìŠ¤íƒ€ì¼ */
        .ad-banner { display: flex; gap: 10px; margin-bottom: 20px; }
        .ad-item { flex: 1; padding: 15px; border: 2px solid #ffcc00; text-align: center; font-weight: 900; border-radius: 10px; animation: flash 0.8s infinite alternate; }
        @keyframes flash { from { opacity: 1; } to { opacity: 0.6; } }

        /* ğŸ° ìŠ¬ë¡¯ ë¨¸ì‹  (ì´ëª¨ì§€ ì ìš©) */
        .slot-container { display: flex; justify-content: center; gap: 15px; margin: 30px 0; }
        .reel { width: 120px; height: 150px; background: #fff; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 70px; color: #000; border: 4px solid #444; overflow: hidden; }
        .spinning { animation: reel-spin 0.1s infinite; }
        @keyframes reel-spin { 0% { transform: translateY(-10px); } 50% { transform: translateY(10px); } 100% { transform: translateY(-10px); } }

        /* ğŸƒ ë°”ì¹´ë¼ (ì‚¬ì‹¤ì ì¸ ì¹´ë“œ ì´ë¯¸ì§€ ì—°ì¶œ) */
        .bac-table { background: radial-gradient(circle, #2e7d32, #1b5e20); border: 10px solid #3e2723; border-radius: 100px; padding: 40px; display: flex; justify-content: center; gap: 50px; position: relative; box-shadow: inset 0 0 30px #000; }
        .card-slot { width: 90px; height: 130px; background: #06402b; border: 2px dashed rgba(255,255,255,0.3); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 40px; font-weight: 900; transition: transform 0.6s; transform-style: preserve-3d; color: #000; }
        .card-flip { background: #fff url('https://www.transparenttextures.com/patterns/white-paper.png') !important; transform: rotateY(180deg); box-shadow: 2px 2px 10px rgba(0,0,0,0.5); }

        /* ğŸŒ ë‹¬íŒ½ì´ íŠ¸ë™ ì‚¬ì‹¤í™” */
        .track { background: #333; border: 2px solid #555; border-radius: 10px; margin-bottom: 5px; height: 60px; position: relative; overflow: hidden; }
        .track-line { position: absolute; right: 50px; top: 0; bottom: 0; border-left: 3px dashed gold; z-index: 1; }
        .snail-unit { position: absolute; left: 10px; font-size: 40px; z-index: 2; transition: left 0.1s linear; }

        .game-panel { background: var(--panel-bg); border-radius: 20px; padding: 40px; text-align: center; border: 1px solid #333; margin-bottom: 20px; }
        .btn-play { background: linear-gradient(to bottom, #ffd700, #b8860b); color: #000; border: none; padding: 15px 40px; font-weight: 900; font-size: 18px; border-radius: 10px; cursor: pointer; box-shadow: 0 5px 0 #7b6500; }
        .btn-play:active { transform: translateY(4px); box-shadow: none; }
        
        .view { display: none; }
        .active-view { display: block; }
    </style>
</head>
<body>
    <div id="resultPopup">
        <h1 id="popTitle" style="font-size:45px; margin:0;">WIN</h1>
        <h2 id="popAmount" style="color:gold; font-size:30px;">+ 0</h2>
        <button class="btn-play" onclick="closePopup()">í™•ì¸</button>
    </div>

    <div class="top-nav">
        <div class="logo" onclick="showView('lobby')">S SUPER 9 BET</div>
        <div class="nav-right" style="display:flex; align-items:center; gap:20px;">
            <div class="asset-box">â‚© <span id="assetVal">0</span></div>
            <div id="userNick" style="color:white; font-weight:900;">ë¡œë”© ì¤‘...</div>
            <button onclick="handleLogout()" style="background:none; border:1px solid #ff5252; color:#ff5252; padding:5px 10px; cursor:pointer; border-radius:5px;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>

    <div class="main-wrapper">
        <div class="sidebar">
            <div id="m-lobby" class="menu-item menu-active" onclick="showView('lobby')">ë©”ì¸ ë¡œë¹„</div>
            <div id="m-slotView" class="menu-item" onclick="showView('slotView')">777ìŠ¬ë¡¯</div>
            <div id="m-bacView" class="menu-item" onclick="showView('bacView')">ë°”ì¹´ë¼</div>
            <div id="m-snailView" class="menu-item" onclick="showView('snailView')">ë‹¬íŒ½ì´ ë ˆì´ìŠ¤</div>
            <div id="m-myPage" class="menu-item" onclick="showView('myPage')">ë‚˜ì˜ ë² íŒ…ê¸°ë¡</div>
        </div>

        <div class="content">
            <div id="lobby" class="view active-view">
                <div class="ad-banner">
                    <div class="ad-item" style="background: red; color: yellow;">ğŸ”¥ [ê³µì§€] ì‹ ê·œ ì²«ì¶© 30% ë¬´í•œ ì§€ê¸‰ ì´ë²¤íŠ¸ ğŸ”¥</div>
                    <div class="ad-item" style="background: blue; color: white;">ğŸ’ [ë³´ì¦] ë©”ì´ì € ì•ˆì „ ë†€ì´í„° SUPER 9 ğŸ’</div>
                </div>
                <div class="game-panel" style="background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1596838132731-3301c3fd4317?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80'); background-size: cover;">
                    <h1 style="color:gold; font-size: 60px; text-shadow: 0 0 20px gold;">SUPER 9 BET</h1>
                    <p style="font-size: 22px; font-weight: 700;">ì¡°ì‘ ì—†ëŠ” ì‹¤ì‹œê°„ ë¼ì´ë¸Œ ê²Œì„ì˜ ì •ì„</p>
                </div>
            </div>

            <div id="slotView" class="view">
                <div class="game-panel">
                    <h2 style="color:gold;">ğŸ° PREMIMUM SLOT ğŸ°</h2>
                    <div class="slot-container">
                        <div id="r1" class="reel">ğŸ’</div>
                        <div id="r2" class="reel">ğŸ’</div>
                        <div id="r3" class="reel">ğŸ’</div>
                    </div>
                    <input type="number" id="slotBet" style="background:#000; color:gold; padding:15px; border:2px solid #444; width:200px; font-size:20px; text-align:center;" value="10000">
                    <button class="btn-play" onclick="playSlot()">SPIN NOW</button>
                </div>
            </div>

            <div id="bacView" class="view">
                <div class="game-panel">
                    <div class="bac-table">
                        <div>
                            <p style="color:#4facfe; font-size:20px; font-weight:900;">PLAYER</p>
                            <div style="display:flex; gap:10px;">
                                <div class="card-slot" id="pC1"></div><div class="card-slot" id="pC2"></div>
                            </div>
                        </div>
                        <div style="display:flex; align-items:center;"><h1 style="color:gold;">VS</h1></div>
                        <div>
                            <p style="color:#ff5252; font-size:20px; font-weight:900;">BANKER</p>
                            <div style="display:flex; gap:10px;">
                                <div class="card-slot" id="bC1"></div><div class="card-slot" id="bC2"></div>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top:20px;">
                        <input type="number" id="bacBet" style="background:#000; color:gold; padding:15px; border:2px solid #444; width:150px; text-align:center;" value="10000">
                        <button class="btn-play" style="background:#4facfe;" onclick="playBac('player')">PLAYER</button>
                        <button class="btn-play" style="background:#ff5252;" onclick="playBac('banker')">BANKER</button>
                    </div>
                </div>
            </div>

            <div id="snailView" class="view">
                <div class="game-panel" style="text-align:left;">
                    <h2 style="text-align:center; color:gold;">ğŸŒ REAL-TIME SNAIL RACE ğŸŒ</h2>
                    <div class="track"><div class="track-line"></div><div id="s0" class="snail-unit">ğŸŒ</div></div>
                    <div class="track"><div class="track-line"></div><div id="s1" class="snail-unit" style="filter: hue-rotate(90deg);">ğŸŒ</div></div>
                    <div class="track"><div class="track-line"></div><div id="s2" class="snail-unit" style="filter: hue-rotate(200deg);">ğŸŒ</div></div>
                    <div style="text-align:center; margin-top:20px;">
                        <select id="snailPick" style="padding:15px; background:#000; color:white;">
                            <option value="0">1ë²ˆ ë¹¨ê°„ ë‹¬íŒ½ì´</option>
                            <option value="1">2ë²ˆ íŒŒë€ ë‹¬íŒ½ì´</option>
                            <option value="2">3ë²ˆ ë³´ë¼ ë‹¬íŒ½ì´</option>
                        </select>
                        <input type="number" id="snailBet" style="background:#000; color:gold; padding:15px; border:2px solid #444; width:150px;" value="10000">
                        <button class="btn-play" id="snailBtn" onclick="playSnail()">RACE START</button>
                    </div>
                </div>
            </div>

            <div id="myPage" class="view">
                <div class="game-panel" style="text-align:left;">
                    <h2 style="color:gold;">ğŸ“Š ë‚˜ì˜ ìƒì„¸ ë² íŒ… ë‚´ì—­</h2>
                    <div id="historyList" style="background:#000; padding:10px; border-radius:10px; max-height:500px; overflow-y:auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, collection, addDoc, getDocs, query, where, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4", authDomain: "gambling-23339.firebaseapp.com", projectId: "gambling-23339", storageBucket: "gambling-23339.firebasestorage.app", messagingSenderId: "1031894079454", appId: "1:1031894079454:web:960ca0f1748493cdd9af4f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userObj = null, curBal = 0, isPlaying = false;

        onAuthStateChanged(auth, async (user) => {
            if(user) {
                userObj = user;
                const snap = await getDoc(doc(db, "users", user.uid));
                if(!snap.exists()) { handleLogout(); return; }
                const data = snap.data();
                document.getElementById('userNick').innerText = data.nickname + "ë‹˜";
                updateAssetDisplay(data.balance);
            } else { location.href = "login.html"; }
        });

        function updateAssetDisplay(v) { curBal = v; document.getElementById('assetVal').innerText = v.toLocaleString(); }

        async function saveResult(game, bet, profit) {
            await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit) });
            updateAssetDisplay(curBal + profit);
            await addDoc(collection(db, "history"), { uid: userObj.uid, game: game, bet: bet, profit: profit, time: new Date() });
        }

        // --- ìŠ¬ë¡¯ (ì†ë„ ë° ì´ëª¨í‹°ì½˜ ë³µêµ¬) ---
        window.playSlot = async () => {
            if(isPlaying) return;
            const bet = parseInt(document.getElementById('slotBet').value);
            if(bet > curBal || bet <= 0) return alert("ì”ì•¡ ë¶€ì¡±");
            isPlaying = true;
            const reels = [document.getElementById('r1'), document.getElementById('r2'), document.getElementById('r3')];
            reels.forEach(r => r.classList.add('spinning'));
            setTimeout(async () => {
                reels.forEach(r => r.classList.remove('spinning'));
                const items = ['7ï¸âƒ£','ğŸ’','ğŸ’','ğŸ‹','ğŸ‡'];
                const r = [items[Math.floor(Math.random()*5)], items[Math.floor(Math.random()*5)], items[Math.floor(Math.random()*5)]];
                reels.forEach((el, i) => el.innerText = r[i]);
                let mul = 0;
                if(r[0]===r[1] && r[1]===r[2]) mul = r[0]==='7ï¸âƒ£' ? 17.7 : 5.0;
                else if(r[0]===r[1] || r[1]===r[2] || r[0]===r[2]) mul = 1.5;
                const profit = (bet * mul) - bet;
                await saveResult("ìŠ¬ë¡¯", bet, profit);
                showPopup(profit >= 0, profit);
                isPlaying = false;
            }, 1500); // ì›ë³¸ ì†ë„
        };

        // --- ë°”ì¹´ë¼ (ì¹´ë“œ ë’¤ì§‘ê¸° ì—°ì¶œ) ---
        window.playBac = async (pick) => {
            if(isPlaying) return;
            const bet = parseInt(document.getElementById('bacBet').value);
            if(bet > curBal || bet <= 0) return alert("ì”ì•¡ ë¶€ì¡±");
            isPlaying = true;
            const slots = [document.getElementById('pC1'), document.getElementById('pC2'), document.getElementById('bC1'), document.getElementById('bC2')];
            slots.forEach(s => { s.innerText = ""; s.classList.remove('card-flip'); });
            setTimeout(() => {
                const vals = [Math.floor(Math.random()*9)+1, Math.floor(Math.random()*9)+1, Math.floor(Math.random()*9)+1, Math.floor(Math.random()*9)+1];
                slots.forEach((s, i) => {
                    setTimeout(() => {
                        s.classList.add('card-flip');
                        s.innerText = vals[i];
                    }, i * 400);
                });
                setTimeout(async () => {
                    const pSum = (vals[0] + vals[1]) % 10;
                    const bSum = (vals[2] + vals[3]) % 10;
                    let win = 'tie';
                    if(pSum > bSum) win = 'player';
                    else if(bSum > pSum) win = 'banker';
                    const profit = (pick === win) ? (bet * 2.0) - bet : -bet;
                    await saveResult("ë°”ì¹´ë¼", bet, profit);
                    showPopup(profit >= 0, profit);
                    isPlaying = false;
                }, 2000);
            }, 100);
        };

        // --- ë‹¬íŒ½ì´ (ì›ë³¸ ì†ë„ ë³µêµ¬) ---
        window.playSnail = async () => {
            const bet = parseInt(document.getElementById('snailBet').value);
            const pick = parseInt(document.getElementById('snailPick').value);
            if(bet > curBal || isPlaying) return;
            isPlaying = true;
            let pos = [10, 10, 10];
            const snails = [document.getElementById('s0'), document.getElementById('s1'), document.getElementById('s2')];
            const race = setInterval(async () => {
                for(let i=0; i<3; i++) {
                    pos[i] += Math.random() * 8; // ì›ë³¸ ì†ë„ ë³€ìˆ˜
                    snails[i].style.left = pos[i] + "px";
                    if(pos[i] >= 610) {
                        clearInterval(race);
                        const winner = pos.indexOf(Math.max(...pos));
                        const profit = (pick === winner) ? (bet * 2.8) - bet : -bet;
                        await saveResult("ë‹¬íŒ½ì´", bet, profit);
                        showPopup(profit >= 0, profit);
                        isPlaying = false;
                        setTimeout(() => snails.forEach(s => s.style.left = "10px"), 2000);
                        break;
                    }
                }
            }, 50);
        };

        // --- ì›ë³¸ ë¡œì§ ìœ ì§€ ---
        window.showView = (v) => {
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active-view'));
            document.querySelectorAll('.menu-item').forEach(e => e.classList.remove('menu-active'));
            document.getElementById(v).classList.add('active-view');
            document.getElementById('m-'+v).classList.add('menu-active');
            if(v === 'myPage') loadHistory();
        };
        window.showPopup = (win, am) => {
            document.getElementById('popTitle').innerText = win ? "WIN!" : "LOSE";
            document.getElementById('popTitle').style.color = win ? "#4caf50" : "#ff5252";
            document.getElementById('popAmount').innerText = (am >= 0 ? "+" : "") + am.toLocaleString();
            document.getElementById('resultPopup').style.display = 'block';
        };
        window.closePopup = () => document.getElementById('resultPopup').style.display = 'none';
        window.handleLogout = () => signOut(auth).then(() => location.href="login.html");
        async function loadHistory() {
            const q = query(collection(db, "history"), where("uid", "==", userObj.uid), orderBy("time", "desc"), limit(20));
            const snap = await getDocs(q);
            document.getElementById('historyList').innerHTML = snap.docs.map(d => {
                const h = d.data();
                return `<div style="padding:15px; border-bottom:1px solid #222;">[${h.game}] ${h.profit >=0 ? 'ìˆ˜ìµ' : 'ì†ì‹¤'}: <span style="color:${h.profit>=0?'#4facfe':'#ff5252'}">${h.profit.toLocaleString()}</span> (ë² íŒ…: ${h.bet.toLocaleString()})</div>`;
            }).join('') || "ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.";
        }
    </script>
</body>
</html>