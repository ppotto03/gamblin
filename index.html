<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUPER 9 BET - PREMIERE</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #0d0d0d;
            --card-bg: #1a1a1a;
            --text-gold: #eebb4d;
            --neon-gold: rgba(238, 187, 77, 0.7);
            --accent-red: #ff073a;
        }

        body {
            background-color: var(--bg-color);
            color: #fff;
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0; padding: 0;
        }

        /* --- Í≥†Í∏âÏä§Îü¨Ïö¥ ÏûÖÎ†•Ï∞Ω & MAX Î≤ÑÌäº --- */
        .input-group { position: relative; display: flex; align-items: center; margin-bottom: 15px; }
        
        input[type="email"], input[type="password"], input[type="number"] {
            background: #000; border: 1px solid #333; color: var(--text-gold);
            padding: 15px; border-radius: 8px; width: 100%; font-weight: bold;
            font-size: 16px; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--text-gold); box-shadow: 0 0 10px var(--neon-gold); }

        .btn-max {
            position: absolute; right: 10px; background: #eebb4d; color: #000;
            border: none; padding: 5px 10px; border-radius: 4px; font-weight: 900;
            cursor: pointer; font-size: 11px;
        }

        /* --- ÌîÑÎ¶¨ÎØ∏ÏóÑ Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ --- */
        .app-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: #000; border-bottom: 2px solid #222;
            position: sticky; top: 0; z-index: 1000;
        }
        .logo { font-size: 24px; font-weight: 900; font-style: italic; color: #fff; }
        .logo span { color: var(--accent-red); text-shadow: 0 0 10px var(--accent-red); }

        .balance-badge {
            background: linear-gradient(45deg, #eebb4d, #bf953f);
            color: #000; padding: 7px 15px; border-radius: 5px; font-weight: 800;
        }

        .view { display: none; padding: 20px; animation: fadeIn 0.4s; }
        .active-view { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Í≤åÏûÑ Í∑∏Î¶¨Îìú --- */
        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .game-card {
            background: var(--card-bg); border-radius: 12px; overflow: hidden;
            border: 1px solid #333; cursor: pointer; transition: 0.3s;
        }
        .game-card:hover { border-color: var(--text-gold); transform: translateY(-5px); }
        .game-thumb { width: 100%; height: 110px; background-size: cover; background-position: center; }
        .game-info { padding: 10px; }

        /* --- Î¶¨Ïñº Î∞îÏπ¥Îùº ÌÖåÏù¥Î∏î --- */
        .real-table {
            background: radial-gradient(circle, #0a4d26 0%, #052914 100%);
            border: 10px solid #3d2b1f; border-radius: 50px;
            height: 280px; position: relative; margin-bottom: 20px;
            display: flex; justify-content: space-around; align-items: center;
        }
        .card-container { text-align: center; }
        .card-img {
            width: 80px; height: 115px; background: url('https://deckofcardsapi.com/static/img/back.png') center/cover;
            border-radius: 6px; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: 10px auto;
        }
        .card-reveal { transform: rotateY(180deg); background-size: cover; }

        /* --- Ïä¨Î°Ø Î®∏Ïã† --- */
        .slot-body {
            background: #000; border: 4px solid var(--text-gold); border-radius: 20px;
            display: flex; justify-content: center; gap: 15px; padding: 30px 10px;
            margin-bottom: 20px; box-shadow: 0 0 20px var(--neon-gold);
        }
        .reel {
            width: 80px; height: 100px; background: #1a1a1a; border: 1px solid #333;
            border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 50px;
        }

        .btn-bet {
            background: linear-gradient(to bottom, #f3d078, #eebb4d);
            color: #000; font-weight: 900; padding: 18px; border: none; border-radius: 10px;
            width: 100%; cursor: pointer; font-size: 18px; margin-top: 10px;
        }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, arrayUnion } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4",
            authDomain: "gambling-23339.firebaseapp.com",
            projectId: "gambling-23339",
            storageBucket: "gambling-23339.firebasestorage.app",
            messagingSenderId: "1031894079454",
            appId: "1:1031894079454:web:960ca0f1748493cdd9af4f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userData = { balance: 0 };

        window.showView = (id) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
            document.getElementById(id).classList.add('active-view');
            if(id === 'snailGame') startSnailLoop();
        };

        const refresh = async () => {
            if(!auth.currentUser) return;
            const snap = await getDoc(doc(db, "users", auth.currentUser.uid));
            userData = snap.data();
            document.querySelectorAll('.balance-val').forEach(el => el.innerText = userData.balance.toLocaleString());
        };

        onAuthStateChanged(auth, (user) => { user ? (refresh(), showView('lobby')) : showView('login'); });

        window.doLogin = async () => {
            try {
                await signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('pw').value);
            } catch(e) { alert("Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî."); }
        };

        // --- Ïä¨Î°Ø Î®∏Ïã† (9Ï¢Ö Í≥ºÏùº, 17.7Î∞∞) ---
        const fruits = ['üçé', 'üçä', 'üçá', 'üçí', 'üíé', '7', 'üçâ', 'üçã', 'üí∞'];
        window.runSlot = async () => {
            const bet = parseInt(document.getElementById('slot-bet').value);
            if(bet > userData.balance || bet <= 0) return alert("ÏûîÏï° Î∂ÄÏ°±");
            await updateDoc(doc(db, "users", auth.currentUser.uid), { balance: increment(-bet) });
            refresh();

            const reels = [document.getElementById('r1'), document.getElementById('r2'), document.getElementById('r3')];
            let count = 0;
            const spin = setInterval(async () => {
                reels.forEach(r => r.innerText = fruits[Math.floor(Math.random()*9)]);
                if(++count > 20) {
                    clearInterval(spin);
                    const res = reels.map(r => r.innerText);
                    let multi = 0;
                    if(res[0]==='7' && res[1]==='7' && res[2]==='7') multi = 17.7;
                    else if(res[0]===res[1] && res[1]===res[2]) multi = 2;
                    else if(res[0]===res[1] || res[1]===res[2] || res[0]===res[2]) multi = 1;

                    const profit = Math.floor(bet * multi);
                    await updateDoc(doc(db, "users", auth.currentUser.uid), {
                        balance: increment(profit),
                        history: arrayUnion({ game: 'slot', bet, profit: profit-bet, time: new Date().toISOString() })
                    });
                    refresh();
                    if(multi > 1) alert(`üéâ Ï∂ïÌïòÌï©ÎãàÎã§! ${multi}Î∞∞ ÎãπÏ≤®!`);
                }
            }, 60);
        };

        // --- ÏßÑÏßú Î∞îÏπ¥Îùº (Ïπ¥Îìú Ïù¥ÎØ∏ÏßÄ & Ïä¨Î°úÏö∞ Î™®ÏÖò) ---
        window.runBac = async (pick) => {
            const bet = parseInt(document.getElementById('bac-bet').value);
            if(bet > userData.balance || bet <= 0) return alert("ÏûîÏï° Î∂ÄÏ°±");
            await updateDoc(doc(db, "users", auth.currentUser.uid), { balance: increment(-bet) });
            refresh();

            const pCard = document.getElementById('p-card');
            const bCard = document.getElementById('b-card');
            pCard.style.backgroundImage = "url('https://deckofcardsapi.com/static/img/back.png')";
            bCard.style.backgroundImage = "url('https://deckofcardsapi.com/static/img/back.png')";
            pCard.classList.remove('card-reveal'); bCard.classList.remove('card-reveal');

            // Ïä¨Î°úÏö∞ ÎîúÎßÅ
            setTimeout(() => {
                const pVal = Math.floor(Math.random()*10);
                pCard.style.backgroundImage = `url('https://deckofcardsapi.com/static/img/${pVal === 0 ? '0' : pVal}H.png')`;
                pCard.classList.add('card-reveal');
                
                setTimeout(() => {
                    const bVal = Math.floor(Math.random()*10);
                    bCard.style.backgroundImage = `url('https://deckofcardsapi.com/static/img/${bVal === 0 ? '0' : bVal}S.png')`;
                    bCard.classList.add('card-reveal');

                    const result = pVal > bVal ? 'player' : (bVal > pVal ? 'banker' : 'tie');
                    let multi = (pick === result) ? (result === 'tie' ? 10 : 2) : 0;
                    
                    setTimeout(async () => {
                        alert(`Í≤∞Í≥º: ${result.toUpperCase()}`);
                        await updateDoc(doc(db, "users", auth.currentUser.uid), {
                            balance: increment(bet * multi),
                            history: arrayUnion({ game: 'baccarat', bet, profit: (bet*multi)-bet, time: new Date().toISOString() })
                        });
                        refresh();
                    }, 600);
                }, 1000);
            }, 800);
        };

        // --- Î¶¨Ïñº Îã¨ÌåΩÏù¥ Î†àÏù¥Ïã± (Ïã§ÏÇ¨ Ïù¥ÎØ∏ÏßÄ) ---
        let snailPos = [10, 10, 10];
        const realSnailImg = new Image(); realSnailImg.src = "https://cdn-icons-png.flaticon.com/512/826/826912.png"; 
        
        function startSnailLoop() {
            const cvs = document.getElementById('snailCanvas');
            const ctx = cvs.getContext('2d');
            function draw() {
                // Ìùô Î∞∞Í≤Ω
                ctx.fillStyle = "#3d2b1f"; ctx.fillRect(0,0,cvs.width, cvs.height);
                ctx.fillStyle = "#2a1d14";
                for(let i=0; i<cvs.width; i+=50) ctx.fillRect(i, 0, 2, cvs.height);
                
                // Ìä∏Îûô
                ctx.strokeStyle = "rgba(255,255,255,0.1)";
                for(let i=1; i<3; i++) { ctx.beginPath(); ctx.moveTo(0, i*100); ctx.lineTo(cvs.width, i*100); ctx.stroke(); }
                
                // Í≥®ÎùºÏù∏
                ctx.fillStyle = "#eebb4d"; ctx.fillRect(740, 0, 10, 300);

                for(let i=0; i<3; i++) {
                    ctx.drawImage(realSnailImg, snailPos[i], i*100 + 15, 70, 70);
                }
                requestAnimationFrame(draw);
            }
            draw();
        }

        window.runSnail = async () => {
            const bet = parseInt(document.getElementById('snail-bet').value);
            const pick = parseInt(document.querySelector('input[name="spick"]:checked').value);
            if(bet > userData.balance || bet <= 0) return alert("ÏûîÏï° Î∂ÄÏ°±");
            await updateDoc(doc(db, "users", auth.currentUser.uid), { balance: increment(-bet) });
            refresh();

            const race = setInterval(async () => {
                let winner = -1;
                for(let i=0; i<3; i++) {
                    snailPos[i] += Math.random()*4.5;
                    if(snailPos[i] >= 680) winner = i;
                }
                if(winner !== -1) {
                    clearInterval(race);
                    const win = winner === pick;
                    alert(win ? "ÏäπÎ¶¨!" : "Ìå®Î∞∞..");
                    await updateDoc(doc(db, "users", auth.currentUser.uid), {
                        balance: increment(win ? bet*2.9 : 0),
                        history: arrayUnion({ game: 'snail', bet, profit: win ? bet*1.9 : -bet, time: new Date().toISOString() })
                    });
                    snailPos = [10, 10, 10]; refresh();
                }
            }, 30);
        };

        window.setMax = (id) => document.getElementById(id).value = userData.balance;

    </script>
</head>
<body>

    <div id="login" class="view active-view">
        <div style="max-width:350px; margin: 150px auto; text-align:center;">
            <h1 class="logo" style="font-size:40px;">SUPER <span>9</span> BET</h1>
            <input type="email" id="email" placeholder="ÏïÑÏù¥Îîî(Ïù¥Î©îÏùº)" style="margin-bottom:10px;">
            <input type="password" id="pw" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏">
            <button class="btn-bet" onclick="doLogin()">ÏûÖÏû•ÌïòÍ∏∞</button>
        </div>
    </div>

    <div id="lobby" class="view">
        <div class="app-header">
            <div class="logo">SUPER <span>9</span> BET</div>
            <div class="balance-badge">‚Ç© <span class="balance-val">0</span></div>
        </div>
        <div class="game-grid" style="margin-top:20px;">
            <div class="game-card" onclick="showView('slotGame')">
                <div class="game-thumb" style="background-image:url('https://images.unsplash.com/photo-1596838132731-3301c3fd4317?w=400');"></div>
                <div class="game-info"><div style="font-weight:900;">777 Ïä¨Î°Ø (17.7x)</div></div>
            </div>
            <div class="game-card" onclick="showView('bacGame')">
                <div class="game-thumb" style="background-image:url('https://images.unsplash.com/photo-1511193311914-0346f16efe90?w=400');"></div>
                <div class="game-info"><div style="font-weight:900;">VIP Î∞îÏπ¥Îùº (10x)</div></div>
            </div>
            <div class="game-card" onclick="showView('snailGame')" style="grid-column: span 2;">
                <div class="game-thumb" style="background-image:url('https://img.freepik.com/free-photo/snail-action-fantasy-nature_23-2150274577.jpg');"></div>
                <div class="game-info"><div style="font-weight:900;">Ïä§ÌîºÎìú Îã¨ÌåΩÏù¥ Î†àÏù¥Ïã±</div></div>
            </div>
        </div>
    </div>

    <div id="slotGame" class="view">
        <div class="app-header">
            <div onclick="showView('lobby')"><i class="fa-solid fa-chevron-left"></i></div>
            <div class="balance-badge">‚Ç© <span class="balance-val">0</span></div>
        </div>
        <h2 style="text-align:center; color:var(--text-gold);">üé∞ 777 LUCKY SLOT</h2>
        <div class="slot-body">
            <div class="reel" id="r1">7</div>
            <div class="reel" id="r2">7</div>
            <div class="reel" id="r3">7</div>
        </div>
        <div class="input-group">
            <input type="number" id="slot-bet" value="10000">
            <button class="btn-max" onclick="setMax('slot-bet')">MAX</button>
        </div>
        <button class="btn-bet" onclick="runSlot()">SPIN!</button>
    </div>

    <div id="bacGame" class="view">
        <div class="app-header">
            <div onclick="showView('lobby')"><i class="fa-solid fa-chevron-left"></i></div>
            <div class="balance-badge">‚Ç© <span class="balance-val">0</span></div>
        </div>
        <h2 style="text-align:center; color:var(--text-gold);">üÉè VIP BACCARAT</h2>
        <div class="real-table">
            <div class="card-container">
                <div style="font-weight:900; color:#4285f4;">PLAYER</div>
                <div id="p-card" class="card-img"></div>
            </div>
            <div class="card-container">
                <div style="font-weight:900; color:#ea4335;">BANKER</div>
                <div id="b-card" class="card-img"></div>
            </div>
        </div>
        <div class="input-group">
            <input type="number" id="bac-bet" value="10000">
            <button class="btn-max" onclick="setMax('bac-bet')">MAX</button>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
            <button class="btn-bet" style="background:#4285f4; color:#fff;" onclick="runBac('player')">P (2Î∞∞)</button>
            <button class="btn-bet" style="background:#34a853; color:#fff;" onclick="runBac('tie')">T (10Î∞∞)</button>
            <button class="btn-bet" style="background:#ea4335; color:#fff;" onclick="runBac('banker')">B (2Î∞∞)</button>
        </div>
    </div>

    <div id="snailGame" class="view">
        <div class="app-header">
            <div onclick="showView('lobby')"><i class="fa-solid fa-chevron-left"></i></div>
            <div class="balance-badge">‚Ç© <span class="balance-val">0</span></div>
        </div>
        <h2 style="text-align:center; color:var(--text-gold);">üêå REAL SNAIL RACE</h2>
        <canvas id="snailCanvas" width="800" height="300" style="width:100%; border-radius:15px;"></canvas>
        <div style="display:flex; justify-content:center; gap:20px; margin:20px 0;">
            <label><input type="radio" name="spick" value="0" checked> 1Î≤à</label>
            <label><input type="radio" name="spick" value="1"> 2Î≤à</label>
            <label><input type="radio" name="spick" value="2"> 3Î≤à</label>
        </div>
        <div class="input-group">
            <input type="number" id="snail-bet" value="10000">
            <button class="btn-max" onclick="setMax('snail-bet')">MAX</button>
        </div>
        <button class="btn-bet" onclick="runSnail()">RACE START</button>
    </div>

</body>
</html>