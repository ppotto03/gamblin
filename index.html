<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S SUPER 9 BET | ë¼ì´ë¸Œ ì„œë¹„ìŠ¤</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main-green: #2e7d32; --dark-bg: #121212; --point-gold: #eebb4d; --card-green: #1b5e20; }
        body { background-color: #000; color: #eee; font-family: 'Noto Sans KR', sans-serif; margin: 0; }
        
        /* í—¤ë” & ë„¤ë¹„ */
        .top-nav { background: linear-gradient(to bottom, #4caf50, #2e7d32); height: 50px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; font-weight: bold; }
        .logo { font-size: 22px; font-style: italic; color: #fff; cursor: pointer; }
        .nav-links span { margin-left: 15px; cursor: pointer; font-size: 13px; }

        /* ë ˆì´ì•„ì›ƒ */
        .main-container { display: flex; min-height: 90vh; }
        .sidebar { width: 200px; background: #111; border-right: 1px solid #222; padding: 20px 0; }
        .menu-item { padding: 15px 20px; cursor: pointer; font-size: 14px; border-bottom: 1px solid #1a1a1a; }
        .menu-item:hover { background: #222; color: var(--point-gold); }
        .content { flex: 1; padding: 20px; background: #181818; }

        /* í¼ & ë²„íŠ¼ */
        input { background: #000; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 4px; outline: none; }
        .btn-gold { background: var(--point-gold); color: #000; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 4px; }
        .view { display: none; }
        .active-view { display: block; }

        /* ë°”ì¹´ë¼ & ìŠ¬ë¡¯ */
        .game-screen { background: #000; border: 2px solid #333; padding: 20px; border-radius: 8px; text-align: center; }
        .card-img { width: 60px; height: 90px; background-size: cover; display: inline-block; margin: 5px; border-radius: 4px; transition: 0.5s; }
        
        /* ê²Œì‹œíŒ í…Œì´ë¸” */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; border-bottom: 1px solid #333; text-align: left; font-size: 13px; }
        .secret-icon { color: #888; margin-right: 5px; }

        /* ëª¨ë‹¬/íŒì—… ìŠ¤íƒ€ì¼ */
        #loginOverlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:flex; justify-content:center; align-items:center; z-index:9999; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div style="background:#222; padding:40px; border-radius:10px; text-align:center; width:300px; border:1px solid var(--main-green);">
            <h2 style="color:var(--main-green)">SUPER 9 BET</h2>
            <input type="email" id="loginEmail" placeholder="ì´ë©”ì¼" style="width:100%; margin-bottom:10px;">
            <input type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸" style="width:100%; margin-bottom:20px;">
            <button class="btn-gold" style="width:100%" onclick="handleAuth()">ì ‘ì†í•˜ê¸°</button>
        </div>
    </div>

    <div class="top-nav">
        <div class="logo" onclick="showView('slotView')">S <span>SUPER 9 BET</span></div>
        <div class="nav-links">
            <span onclick="showView('myPageView')">ë§ˆì´í˜ì´ì§€</span>
            <span onclick="showView('csView')">ê³ ê°ì„¼í„°</span>
            <span onclick="logout()">ë¡œê·¸ì•„ì›ƒ</span>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="menu-item" onclick="showView('slotView')">ğŸ° ìŠ¬ë¡¯ë¨¸ì‹ </div>
            <div class="menu-item" onclick="showView('bacView')">ğŸƒ ë°”ì¹´ë¼</div>
            <div class="menu-item" onclick="showView('snailView')">ğŸŒ ë‹¬íŒ½ì´ ë ˆì´ìŠ¤</div>
        </div>

        <div class="content">
            <div id="slotView" class="view active-view">
                <div class="game-screen">
                    <h3 style="color:var(--point-gold)">LUCKY FRUITS SLOT</h3>
                    <div id="reels" style="font-size:50px; margin:20px 0;">ğŸ | ğŸ | ğŸ</div>
                    <input type="number" id="slotBet" value="10000">
                    <button class="btn-gold" onclick="playSlot()">SPIN</button>
                </div>
            </div>

            <div id="bacView" class="view">
                <div class="game-screen" style="background:var(--card-green)">
                    <h3>VIP BACCARAT</h3>
                    <div id="bacBoard">
                        <div id="pZone" style="display:inline-block; margin:20px;">
                            <p>PLAYER</p>
                            <div id="pCards"></div>
                        </div>
                        <div id="bZone" style="display:inline-block; margin:20px;">
                            <p>BANKER</p>
                            <div id="bCards"></div>
                        </div>
                    </div>
                    <input type="number" id="bacBet" value="10000">
                    <div style="margin-top:10px;">
                        <button class="btn-gold" onclick="playBac('player')">P</button>
                        <button class="btn-gold" onclick="playBac('tie')">T</button>
                        <button class="btn-gold" onclick="playBac('banker')">B</button>
                    </div>
                </div>
            </div>

            <div id="snailView" class="view">
                <div class="game-screen">
                    <h3>REAL SNAIL RACE</h3>
                    <canvas id="snailCanvas" width="600" height="200" style="width:100%; background:#3d2b1f;"></canvas>
                    <div style="margin:15px 0;">
                        <label><input type="radio" name="spick" value="0" checked> 1ë²ˆ</label>
                        <label><input type="radio" name="spick" value="1"> 2ë²ˆ</label>
                        <label><input type="radio" name="spick" value="2"> 3ë²ˆ</label>
                    </div>
                    <input type="number" id="snailBet" value="10000">
                    <button class="btn-gold" onclick="playSnail()">START</button>
                </div>
            </div>

            <div id="myPageView" class="view">
                <h2>ë§ˆì´í˜ì´ì§€</h2>
                <div class="game-screen" style="text-align:left;">
                    <p>ì•„ì´ë””: <span id="myId">-</span></p>
                    <p>ê°€ì…ë‚ ì§œ: <span id="myJoinDate">-</span></p>
                    <p>ë³´ìœ ë¨¸ë‹ˆ: <span style="color:var(--point-gold)" id="myBalance">0</span> KRW</p>
                    <h4>ìµœê·¼ ë² íŒ… ë‚´ì—­</h4>
                    <table id="historyTable">
                        <thead><tr><th>ê²Œì„</th><th>ê¸ˆì•¡</th><th>ìˆ˜ìµ</th><th>ì‹œê°„</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="csView" class="view">
                <h2>ê³ ê°ì„¼í„°</h2>
                <div class="game-screen" style="text-align:left;">
                    <div id="writeBox">
                        <input type="text" id="csTitle" placeholder="ì œëª©" style="width:70%;">
                        <label><input type="checkbox" id="csSecret"> ë¹„ê³µê°œ</label>
                        <textarea id="csContent" style="width:100%; height:80px; margin-top:10px; background:#000; color:#fff; border:1px solid #444;"></textarea>
                        <button class="btn-gold" style="margin-top:5px;" onclick="writeCS()">ë¬¸ì˜ë“±ë¡</button>
                    </div>
                    <table id="csTable">
                        <thead><tr><th>ìƒíƒœ</th><th>ì œëª©</th><th>ì‘ì„±ì</th><th>ë‚ ì§œ</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, increment, arrayUnion, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4", authDomain: "gambling-23339.firebaseapp.com", projectId: "gambling-23339", storageBucket: "gambling-23339.firebasestorage.app", messagingSenderId: "1031894079454", appId: "1:1031894079454:web:960ca0f1748493cdd9af4f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userObj = null;

        // --- Auth & Router ---
        window.handleAuth = async () => {
            const email = document.getElementById('loginEmail').value;
            const pw = document.getElementById('loginPw').value;
            try {
                await signInWithEmailAndPassword(auth, email, pw);
            } catch(e) { alert("ë¡œê·¸ì¸ ì‹¤íŒ¨"); }
        };

        window.logout = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, async (user) => {
            if(user) {
                userObj = user;
                document.getElementById('loginOverlay').style.display = 'none';
                loadUserData();
                loadCS();
            } else {
                document.getElementById('loginOverlay').style.display = 'flex';
            }
        });

        window.showView = (id) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active-view'));
            document.getElementById(id).classList.add('active-view');
            if(id === 'myPageView') loadUserData();
            if(id === 'snailView') initSnail();
        };

        async function loadUserData() {
            const snap = await getDoc(doc(db, "users", userObj.uid));
            if(snap.exists()){
                const d = snap.data();
                document.getElementById('myId').innerText = userObj.email;
                document.getElementById('myJoinDate').innerText = d.joinDate || '2025-01-01';
                document.getElementById('myBalance').innerText = d.balance.toLocaleString();
                
                const tbody = document.querySelector('#historyTable tbody');
                tbody.innerHTML = (d.history || []).slice().reverse().slice(0,5).map(h => `
                    <tr><td>${h.game}</td><td>${h.bet}</td><td style="color:${h.profit>=0?'#4caf50':'#ff5252'}">${h.profit}</td><td>${h.time.slice(5,16)}</td></tr>
                `).join('');
            }
        }

        // --- ê³ ê°ì„¼í„° ê¸°ëŠ¥ ---
        window.writeCS = async () => {
            const title = document.getElementById('csTitle').value;
            const content = document.getElementById('csContent').value;
            const secret = document.getElementById('csSecret').checked;
            if(!title || !content) return;

            await addDoc(collection(db, "cs"), {
                uid: userObj.uid,
                email: userObj.email,
                title, content, secret,
                time: new Date().toISOString(),
                comments: []
            });
            alert("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
            loadCS();
        };

        async function loadCS() {
            const q = query(collection(db, "cs"), orderBy("time", "desc"));
            const snap = await getDocs(q);
            const tbody = document.querySelector('#csTable tbody');
            tbody.innerHTML = snap.docs.map(docSnap => {
                const d = docSnap.data();
                const isMine = d.uid === userObj.uid;
                const isAdmin = userObj.email === 'admin@admin.com';
                
                if(d.secret && !isMine && !isAdmin) {
                    return `<tr><td>ğŸ”’</td><td>ë¹„ê³µê°œ ë¬¸ì˜ê¸€ì…ë‹ˆë‹¤.</td><td>***</td><td>-</td></tr>`;
                }
                return `<tr><td>Q</td><td onclick="alert('${d.content.replace(/\n/g, ' ')}')">${d.title}</td><td>${d.email.split('@')[0]}</td><td>${d.time.slice(5,10)}</td></tr>`;
            }).join('');
        }

        // --- ë°”ì¹´ë¼ (1~2ì¥) ---
        window.playBac = async (pick) => {
            const bet = parseInt(document.getElementById('bacBet').value);
            const userRef = doc(db, "users", userObj.uid);
            const snap = await getDoc(userRef);
            if(snap.data().balance < bet) return alert("ì”ì•¡ ë¶€ì¡±");

            document.getElementById('pCards').innerHTML = ''; document.getElementById('bCards').innerHTML = '';
            
            const card = () => ({ val: Math.floor(Math.random()*9)+1, url: `https://deckofcardsapi.com/static/img/${Math.floor(Math.random()*10)}H.png` });
            
            const p1 = card(), b1 = card();
            renderCard('pCards', p1.url);
            renderCard('bCards', b1.url);

            let pScore = p1.val, bScore = b1.val;

            // 20% í™•ë¥ ë¡œ 2ë²ˆì§¸ ì¹´ë“œ
            if(Math.random() > 0.8) {
                const p2 = card(); renderCard('pCards', p2.url); pScore = (pScore + p2.val)%10;
            }

            const win = pScore > bScore ? 'player' : (bScore > pScore ? 'banker' : 'tie');
            const multi = (pick === win) ? (win === 'tie' ? 10 : 2) : 0;
            
            await updateDoc(userRef, { balance: increment((bet*multi) - bet), history: arrayUnion({ game: 'ë°”ì¹´ë¼', bet, profit: (bet*multi)-bet, time: new Date().toISOString() }) });
            alert(win.toUpperCase() + " ìŠ¹ë¦¬!");
            loadUserData();
        };

        function renderCard(id, url) {
            const div = document.createElement('div');
            div.className = 'card-img'; div.style.backgroundImage = `url(${url})`;
            document.getElementById(id).appendChild(div);
        }

        // --- ë‹¬íŒ½ì´ (ì§„ì§œ ì‚¬ì§„ & ì¶•ì†Œ) ---
        const snailPhoto = new Image(); snailPhoto.src = "https://cdn-icons-png.flaticon.com/512/826/826912.png"; // ì‹¤ì‚¬í˜• ì•„ì´ì½˜
        let snailX = [10, 10, 10];
        window.initSnail = () => {
            const ctx = document.getElementById('snailCanvas').getContext('2d');
            function draw() {
                ctx.fillStyle = "#3d2b1f"; ctx.fillRect(0,0,600,200);
                ctx.strokeStyle = "#555"; for(let i=1;i<3;i++){ ctx.beginPath();ctx.moveTo(0,i*66);ctx.lineTo(600,i*66);ctx.stroke(); }
                ctx.fillStyle = "#eebb4d"; ctx.fillRect(570,0,5,200);
                snailX.forEach((x, i) => ctx.drawImage(snailPhoto, x, i*66 + 10, 45, 45));
                requestAnimationFrame(draw);
            }
            draw();
        };

        window.playSnail = async () => {
            const bet = parseInt(document.getElementById('snailBet').value);
            const pick = parseInt(document.querySelector('input[name="spick"]:checked').value);
            const userRef = doc(db, "users", userObj.uid);
            
            const race = setInterval(async () => {
                let winner = -1;
                snailX = snailX.map((x, i) => {
                    const nx = x + Math.random()*5;
                    if(nx >= 530) winner = i;
                    return nx;
                });
                if(winner !== -1) {
                    clearInterval(race);
                    const win = winner === pick;
                    const profit = win ? Math.floor(bet*2.9) - bet : -bet;
                    await updateDoc(userRef, { balance: increment(profit), history: arrayUnion({ game: 'ë‹¬íŒ½ì´', bet, profit, time: new Date().toISOString() }) });
                    alert(winner+1 + "ë²ˆ ìš°ìŠ¹!");
                    snailX = [10, 10, 10]; loadUserData();
                }
            }, 30);
        };

        // --- ìŠ¬ë¡¯ (9ì¢…) ---
        const syms = ['ğŸ','ğŸŠ','ğŸ‡','ğŸ’','ğŸ’','7ï¸âƒ£','ğŸ‰','ğŸ‹','ğŸ’°'];
        window.playSlot = async () => {
            const bet = parseInt(document.getElementById('slotBet').value);
            const userRef = doc(db, "users", userObj.uid);
            const res = [syms[Math.floor(Math.random()*9)], syms[Math.floor(Math.random()*9)], syms[Math.floor(Math.random()*9)]];
            document.getElementById('reels').innerText = res.join(' | ');
            
            let multi = 0;
            if(res[0]===res[1] && res[1]===res[2]) multi = res[0]==='7ï¸âƒ£'? 17.7 : 5;
            else if(res[0]===res[1] || res[1]===res[2] || res[0]===res[2]) multi = 1;

            const profit = Math.floor(bet * multi) - bet;
            await updateDoc(userRef, { balance: increment(profit), history: arrayUnion({ game: 'ìŠ¬ë¡¯', bet, profit, time: new Date().toISOString() }) });
            loadUserData();
        };

    </script>
</body>
</html>