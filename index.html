<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280">
    <title> SUPER 9 BET CASINO | MANAGEMENT</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --point-gold: #eebb4d; --bg-dark: #0a0a0a; --panel-bg: #151515; --point-green: #2ecc71; }
        body { background-color: var(--bg-dark); color: #eee; font-family: 'Noto Sans KR', sans-serif; margin: 0; overflow-x: auto; min-width: 1280px; }
        #resultPopup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; background: #000; border: 3px solid var(--point-gold); padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 0 50px gold; min-width: 300px; }
        .top-nav { background: linear-gradient(180deg, #1b5e20, #0a2e10); height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; border-bottom: 2px solid #222; position: relative; z-index: 1000; min-width: 1280px; box-sizing: border-box; }
        .logo { font-size: 26px; font-weight: 900; color: #fff; cursor: pointer; font-style: italic; text-shadow: 2px 2px 4px #000; }
        .nav-right { display: flex; align-items: center; gap: 20px; }
        .asset-box { background: #000; padding: 8px 15px; border-radius: 5px; border: 1px solid gold; color: gold; font-weight: 900; font-size: 20px; min-width: 140px; text-align: right; box-shadow: inset 0 0 10px rgba(255,215,0,0.3); }
        .user-menu span { cursor: pointer; color: #bbb; padding: 5px 8px; border-radius: 4px; background: rgba(255,255,255,0.05); font-size: 14px; margin-left:5px; }
        .main-wrapper { display: flex; height: calc(100vh - 70px); min-width: 1280px; }
        .sidebar { width: 220px; background: #0d0d0d; border-right: 1px solid #222; display: flex; flex-direction: column; flex-shrink: 0; }
        .menu-item { padding: 25px 20px; cursor: pointer; color: #888; font-weight: 700; border-left: 5px solid transparent; transition: all 0.2s; font-size: 16px; }
        .menu-item:hover { background: #1a1a1a; color: #ccc; }
        .menu-active { background: #1a1a1a !important; color: #ffff00 !important; border-left: 5px solid #ffff00 !important; font-weight: 900; }
        .content { flex: 1; padding: 30px; overflow-y: auto; background: #111; position: relative; }
        .rule-box { margin: 10px; padding: 15px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; font-size: 12px; color: #aaa; line-height: 1.8; max-height: 300px; overflow-y: auto; }
        .rule-box h4 { color: gold; margin: 0 0 12px 0; border-bottom: 1px solid #444; padding-bottom: 5px; font-size: 14px; text-align: center; }
        .rule-box b { color: #fff; display: block; margin-top: 8px; }
        .rule-box span { color: #eebb4d; }
        .game-panel { background: var(--panel-bg); border-radius: 15px; padding: 30px; text-align: center; border: 1px solid #333; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn-play { background: linear-gradient(to bottom, #ffd700, #b8860b); color: #000; border: none; padding: 12px 30px; font-weight: 900; border-radius: 5px; cursor: pointer; box-shadow: 0 4px 0 #7b6500; }
        .cs-list { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .cs-list th, .cs-list td { border-bottom: 1px solid #333; padding: 12px; text-align: center; }
        .view { display: none; }
        .active-view { display: block; }
        .reply-box { color: var(--point-green); font-size: 12px; margin-top: 8px; padding: 5px; background: #000; border-radius: 4px; border-left: 2px solid var(--point-green); }
        canvas { background: #222; border-radius: 10px; border: 2px solid #333; }
        .bac-table { background: radial-gradient(circle, #2e7d32, #1b5e20); border: 8px solid #3e2723; border-radius: 100px; padding: 30px; display: flex; justify-content: center; gap: 40px; margin: 20px 0; }
        .card-slot { width: 80px; height: 110px; background: rgba(0,0,0,0.3); border-radius: 5px; }
    </style>
</head>
<body>
    <div id="resultPopup">
        <h1 id="popTitle" style="font-size:40px;">WIN</h1>
        <h2 id="popAmount" style="color:gold;">+ 0</h2>
        <button class="btn-play" onclick="closePopup()">í™•ì¸</button>
    </div>

    <div class="top-nav">
        <div class="logo" onclick="showView('lobby')">S SUPER 9 BET</div>
        <div class="nav-right">
            <div class="asset-box">â‚© <span id="assetVal">0</span></div>
            <div class="user-menu">
                <strong id="userNick" style="color:white; margin-right:5px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</strong>
                <span onclick="showView('csCenter')">ê³ ê°ì„¼í„°</span>
                <span onclick="showView('myPage')">ë§ˆì´í˜ì´ì§€</span>
                <span onclick="handleLogout()" style="color:#ff5252;">ë¡œê·¸ì•„ì›ƒ</span>
            </div>
        </div>
    </div>

    <div class="main-wrapper">
        <div class="sidebar">
            <div id="m-lobby" class="menu-item menu-active" onclick="showView('lobby')">ë©”ì¸ ë¡œë¹„</div>
            <div id="m-slotView" class="menu-item" onclick="showView('slotView')">777ìŠ¬ë¡¯</div>
            <div id="m-bacView" class="menu-item" onclick="showView('bacView')">ë°”ì¹´ë¼</div>
            <div id="m-snailView" class="menu-item" onclick="showView('snailView')">ë‹¬íŒ½ì´ ë ˆì´ìŠ¤</div>
            <div class="rule-box">
                <h4>ğŸ“œ ì´ìš© ê·œì • ì•ˆë‚´</h4>
                <b>[ ğŸ° 777ìŠ¬ë¡¯ ]</b>
                â€¢ 7-7-7 ë‹¹ì²¨ : <span>17.4ë°°</span><br>
                â€¢ ë™ì¼ 2ê°œ : <span>1.2ë°°</span> | 7 2ê°œ : <span>2.4ë°°</span>
                <b>[ ğŸƒ ë°”ì¹´ë¼ ]</b>
                â€¢ P/B ìŠ¹ë¦¬ : <span>2.2ë°°</span> | íƒ€ì´ : <span>8.7ë°°</span>
                <b>[ ğŸŒ ë‹¬íŒ½ì´ ]</b>
                â€¢ ìš°ìŠ¹ ì ì¤‘ : <span>2.5ë°°</span>
            </div>
        </div>

        <div class="content">
            <div id="lobby" class="view active-view">
                <div class="game-panel">
                    <h1 style="color:gold; font-size: 45px;">SUPER 9 BET</h1>
                    <p>ë³¸ì¸ ì „ìš© í”Œë ˆì´ ê¸°ë¡ ì‹œìŠ¤í…œ ë„ì… ì™„ë£Œ</p>
                </div>
            </div>

            <div id="slotView" class="view">
                <div class="game-panel">
                    <h2>ğŸ° 777 SLOT</h2>
                    <div style="display:flex; justify-content:center; gap:10px; margin:20px;">
                        <div id="r1" style="font-size:60px; background:#fff; padding:20px; border-radius:10px; color:#000;">â“</div>
                        <div id="r2" style="font-size:60px; background:#fff; padding:20px; border-radius:10px; color:#000;">â“</div>
                        <div id="r3" style="font-size:60px; background:#fff; padding:20px; border-radius:10px; color:#000;">â“</div>
                    </div>
                    <input type="number" id="slotBet" style="background:#000; color:gold; padding:10px;" value="10000">
                    <button class="btn-play" onclick="playSlot()">SPIN</button>
                </div>
            </div>

            <div id="bacView" class="view">
                <div class="game-panel">
                    <div class="bac-table">
                        <div id="pArea"><p style="color:#4facfe;">PLAYER</p><div class="card-slot" id="pC1"></div></div>
                        <div id="bArea"><p style="color:#ff5252;">BANKER</p><div class="card-slot" id="bC1"></div></div>
                    </div>
                    <input type="number" id="bacBet" style="background:#000; color:gold; padding:10px;" value="10000">
                    <div><button class="btn-play" onclick="playBac('player')">P</button> <button class="btn-play" onclick="playBac('banker')">B</button></div>
                </div>
            </div>

            <div id="snailView" class="view">
                <div class="game-panel">
                    <canvas id="snailCanvas" width="700" height="260"></canvas>
                    <div style="margin:15px;"><label><input type="radio" name="snailPick" value="0" checked> 1ë²ˆ</label> <label><input type="radio" name="snailPick" value="1"> 2ë²ˆ</label></div>
                    <input type="number" id="snailBet" style="background:#000; color:gold; padding:10px;" value="10000">
                    <button class="btn-play" onclick="playSnail()">RACE</button>
                </div>
            </div>

            <div id="csCenter" class="view">
                <div class="game-panel" style="text-align:left;">
                    <h2>ğŸ§ CS CENTER <span id="adminBadge" style="display:none; color:gold;">[Admin]</span></h2>
                    <input type="text" id="csTitle" placeholder="ì œëª©" style="width:100%; padding:10px; margin-bottom:5px; background:#000; color:#fff;">
                    <textarea id="csContent" style="width:100%; height:80px; background:#000; color:#fff;"></textarea>
                    <label><input type="checkbox" id="csSecret"> ë¹„ë°€ê¸€</label>
                    <button class="btn-play" style="float:right;" onclick="writeCS()">ë“±ë¡</button>
                    <table class="cs-list"><thead><tr><th>ì œëª©</th><th>ì‹œê°„</th><th>ì•¡ì…˜</th></tr></thead><tbody id="csList"></tbody></table>
                </div>
            </div>

            <div id="myPage" class="view">
                <div class="game-panel" style="text-align:left;">
                    <h2>ğŸ‘¤ MY PAGE</h2>
                    <p id="userInfo">ìœ ì € ì •ë³´ ë¡œë”© ì¤‘...</p>
                    <hr style="border:1px solid #333;">
                    <h3>ë‚˜ì˜ ìµœê·¼ ë² íŒ… ë‚´ì—­</h3>
                    <div id="historyList" style="background:#000; padding:15px; border-radius:10px; max-height:400px; overflow-y:auto;">ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, collection, addDoc, getDocs, query, where, orderBy, limit, deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4", authDomain: "gambling-23339.firebaseapp.com", projectId: "gambling-23339", storageBucket: "gambling-23339.firebasestorage.app", messagingSenderId: "1031894079454", appId: "1:1031894079454:web:960ca0f1748493cdd9af4f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userObj = null, isAdmin = false, curBal = 0;

        // [ë³´ì•ˆ] ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€ ë° DB ì‚­ì œ ê³„ì • ì°¨ë‹¨
        onAuthStateChanged(auth, async (user) => {
            if(user) {
                userObj = user;
                const snap = await getDoc(doc(db, "users", user.uid));
                if(!snap.exists()) {
                    alert("ì •ë³´ê°€ ì—†ëŠ” ê³„ì •ì…ë‹ˆë‹¤. (ì‚­ì œë˜ì—ˆì„ ìˆ˜ ìˆìŒ)");
                    handleLogout();
                    return;
                }
                const data = snap.data();
                isAdmin = data.role === 'admin';
                if(isAdmin) document.getElementById('adminBadge').style.display = 'inline';
                document.getElementById('userNick').innerText = (data.nickname || "íšŒì›") + "ë‹˜";
                document.getElementById('userInfo').innerText = `ì´ë©”ì¼: ${user.email} | ë‹‰ë„¤ì„: ${data.nickname}`;
                updateAssetDisplay(data.balance);
            } else { location.href = "login.html"; }
        });

        function updateAssetDisplay(v) { 
            curBal = v; 
            document.getElementById('assetVal').innerText = v.toLocaleString(); 
        }

        async function processBet(game, bet, profit) {
            await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit) });
            updateAssetDisplay(curBal + profit);
            await addDoc(collection(db, "history"), { uid: userObj.uid, game: game, bet: bet, profit: profit, time: new Date() });
        }

        // [ê°œì¸ë³„ ê¸°ë¡ ì¡°íšŒ ì „ìš©]
        async function loadHistory() {
            const hList = document.getElementById('historyList');
            try {
                const q = query(
                    collection(db, "history"), 
                    where("uid", "==", userObj.uid), // ë³¸ì¸ ê²ƒë§Œ í•„í„°ë§
                    orderBy("time", "desc"), 
                    limit(20)
                );
                const snap = await getDocs(q);
                hList.innerHTML = snap.docs.map(d => {
                    const h = d.data();
                    return `<div style="border-bottom:1px solid #222; padding:10px; font-size:13px;">[${h.game}] ë² íŒ…: ${h.bet.toLocaleString()} | ìˆ˜ìµ: <span style="color:${h.profit>=0?'#4facfe':'#ff5252'}">${h.profit.toLocaleString()}</span></div>`;
                }).join('') || "ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.";
            } catch(e) { hList.innerText = "ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ì¸ë±ìŠ¤ ì„¤ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."; }
        }

        // ìŠ¬ë¡¯ ë¡œì§ (0.3 ì¸í•˜ ë°˜ì˜)
        window.playSlot = async () => {
            const bet = parseInt(document.getElementById('slotBet').value);
            if(bet > curBal) return alert("ì”ì•¡ ë¶€ì¡±");
            const items = ['7ï¸âƒ£','ğŸ’','ğŸ’','ğŸ‹'];
            const r = [items[Math.floor(Math.random()*4)], items[Math.floor(Math.random()*4)], items[Math.floor(Math.random()*4)]];
            document.getElementById('r1').innerText = r[0];
            document.getElementById('r2').innerText = r[1];
            document.getElementById('r3').innerText = r[2];
            let mul = 0;
            if(r[0]==='7ï¸âƒ£'&&r[1]==='7ï¸âƒ£'&&r[2]==='7ï¸âƒ£') mul = 17.4;
            else if(r.filter(x=>x==='7ï¸âƒ£').length===2) mul = 2.4;
            else if(r[0]===r[1] || r[1]===r[2] || r[0]===r[3]) mul = 1.2;
            const p = (bet * mul) - bet;
            processBet("ìŠ¬ë¡¯", bet, p); showPopup(p>=0, p);
        };

        window.showView = (v) => {
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active-view'));
            document.getElementById(v).classList.add('active-view');
            if(v === 'myPage') loadHistory();
            if(v === 'csCenter') loadCS();
        };

        window.writeCS = async () => {
            const t = document.getElementById('csTitle').value, c = document.getElementById('csContent').value, s = document.getElementById('csSecret').checked;
            await addDoc(collection(db, "cs"), { uid: userObj.uid, email: userObj.email, title: t, content: c, secret: s, time: new Date(), reply: "" });
            loadCS();
        };

        async function loadCS() {
            const q = query(collection(db, "cs"), orderBy("time", "desc"));
            const snap = await getDocs(q);
            document.getElementById('csList').innerHTML = snap.docs.map(ds => {
                const d = ds.data();
                const canSee = !d.secret || d.uid === userObj.uid || isAdmin;
                return `<tr><td style="cursor:pointer;" onclick="alert('${canSee?d.content:'ë¹„ë°€ê¸€'}')">${d.secret?'ğŸ”’':''} ${canSee?d.title:'ë¹„ë°€ê¸€'} ${d.reply && canSee ? '<div class="reply">ã„´ë‹µë³€:'+d.reply+'</div>':''}</td><td>${d.time.toDate().toLocaleDateString()}</td><td>${isAdmin?'<button>ì‚­ì œ</button>':'-'}</td></tr>`;
            }).join('');
        }

        window.showPopup = (win, am) => {
            document.getElementById('popTitle').innerText = win ? "WIN!" : "LOSE";
            document.getElementById('popAmount').innerText = am.toLocaleString();
            document.getElementById('resultPopup').style.display = 'block';
        };
        window.closePopup = () => document.getElementById('resultPopup').style.display = 'none';
        window.handleLogout = () => signOut(auth).then(() => location.href="login.html");
    </script>
</body>
</html>