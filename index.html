<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title> SUPER 000 BET CASINO | MANAGEMENT</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --point-gold: #eebb4d; --bg-dark: #0a0a0a; --panel-bg: #151515; --neon-red: #ff0000; --neon-yellow: #ffff00; }
        body { background-color: var(--bg-dark); color: #eee; font-family: 'Noto Sans KR', sans-serif; margin: 0; overflow-x: hidden; }

        /* ê²°ê³¼ íŒì—… */
        #resultPopup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; 
                       background: #000; border: 3px solid var(--point-gold); padding: 40px; border-radius: 20px; text-align: center; box-shadow: 0 0 50px gold; min-width: 280px; }

        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .top-nav { background: linear-gradient(180deg, #1b5e20, #0a2e10); height: 70px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; border-bottom: 2px solid #222; position: relative; z-index: 1000; }
        .logo { font-size: 20px; font-weight: 900; color: #fff; cursor: pointer; font-style: italic; text-shadow: 2px 2px 4px #000; }
        .nav-right { display: flex; align-items: center; gap: 10px; }
        .asset-box { background: #000; padding: 5px 10px; border-radius: 5px; border: 1px solid gold; color: gold; font-weight: 900; font-size: 16px; min-width: 100px; text-align: right; box-shadow: inset 0 0 10px rgba(255,215,0,0.3); }
        .user-menu span { cursor: pointer; color: #bbb; padding: 3px 6px; border-radius: 4px; background: rgba(255,255,255,0.05); font-size: 12px; }

        /* ê´‘ê³  ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes neon-flash { 0% { opacity: 1; filter: brightness(1); } 50% { opacity: 0.7; filter: brightness(1.5); } 100% { opacity: 1; filter: brightness(1); } }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        
        .ad-row { display: flex; gap: 10px; margin-bottom: 20px; }
        .ad-box { flex: 1; height: 50px; display: flex; align-items: center; justify-content: center; font-weight: 900; border: 2px solid #fff; border-radius: 5px; animation: neon-flash 0.3s infinite; font-size: 14px; text-shadow: 1px 1px 2px #000; overflow: hidden; position: relative; text-align: center; }
        .banner-ad { width: 100%; height: 80px; margin-top: 20px; border: 2px solid var(--point-gold); border-radius: 10px; display: flex; align-items: center; justify-content: center; background: #000; position: relative; overflow: hidden; }
        .banner-text { position: absolute; white-space: nowrap; font-size: 20px; font-weight: 900; color: #fff; animation: marquee 12s linear infinite; }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ (ëª¨ë°”ì¼ ëŒ€ì‘ ê°€ë³€ ì²˜ë¦¬) */
        .main-wrapper { display: flex; height: calc(100vh - 70px); flex-direction: row; }
        
        /* ì‚¬ì´ë“œë°” ê°€ë³€í­ */
        .sidebar { width: 220px; background: #0d0d0d; border-right: 1px solid #222; display: flex; flex-direction: column; overflow-y: auto; flex-shrink: 0; }
        
        /* ë©”ë‰´ ìŠ¤íƒ€ì¼ */
        .menu-item { padding: 20px 15px; cursor: pointer; color: #888; font-weight: 700; border-left: 5px solid transparent; transition: all 0.2s; font-size: 14px; }
        .menu-item:hover { background: #1a1a1a; color: #ccc; }
        .menu-active { background: #1a1a1a !important; color: #ffff00 !important; border-left: 5px solid #ffff00 !important; font-weight: 900; }

        .content { flex: 1; padding: 20px; overflow-y: auto; background: #111; position: relative; }

        /* ê²Œì„ ë£° ë°•ìŠ¤ */
        .rule-box { margin: 10px; padding: 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; font-size: 11px; color: #aaa; line-height: 1.8; min-height: 150px; max-height: 250px; overflow-y: auto; }
        .rule-box h4 { color: gold; margin: 0 0 10px 0; border-bottom: 1px solid #444; padding-bottom: 5px; font-size: 13px; text-align: center; }
        .rule-box b { color: #fff; display: block; margin-top: 8px; }
        .rule-box span { color: #eebb4d; }

        /* ì‚¬ì´ë“œ ê´‘ê³  */
        .side-ad { margin-top: auto; padding: 10px; }
        .mini-ad { background: #ff5252; color: #fff; padding: 8px; margin-bottom: 5px; border-radius: 5px; font-size: 11px; text-align: center; font-weight: 900; animation: neon-flash 0.5s infinite alternate; }

        .game-panel { background: var(--panel-bg); border-radius: 15px; padding: 20px; text-align: center; border: 1px solid #333; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .btn-play { background: linear-gradient(to bottom, #ffd700, #b8860b); color: #000; border: none; padding: 10px 20px; font-weight: 900; border-radius: 5px; cursor: pointer; box-shadow: 0 4px 0 #7b6500; font-size: 14px; }
        
        /* ëª¨ë°”ì¼ìš© ì¹´ë“œ ë° ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì • */
        canvas { max-width: 100%; height: auto; }
        .bac-table { background: radial-gradient(circle, #2e7d32, #1b5e20); border: 4px solid #3e2723; border-radius: 50px; padding: 15px; display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .card-slot { width: 60px; height: 85px; background: rgba(0,0,0,0.3); border-radius: 5px; display: inline-block; }

        .cs-list { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
        .cs-list th, .cs-list td { border-bottom: 1px solid #333; padding: 8px; text-align: center; }

        .view { display: none; }
        .active-view { display: block; }

        /* ìŠ¤ë§ˆíŠ¸í° í™”ë©´ ì „ìš© ìŠ¤íƒ€ì¼ (ëª¨ë°”ì¼ ëŒ€ì‘) */
        @media screen and (max-width: 768px) {
            .sidebar { width: 120px; }
            .menu-item { padding: 15px 10px; font-size: 12px; }
            .rule-box { display: none; } /* ëª¨ë°”ì¼ì—ì„œëŠ” ê³µê°„ ë¶€ì¡±ìœ¼ë¡œ ë£°ë°•ìŠ¤ ìˆ¨ê¹€ */
            .logo { font-size: 16px; }
            .ad-box { font-size: 11px; height: 40px; }
        }
    </style>
</head>
<body>

    <div id="resultPopup">
        <h1 id="popTitle" style="font-size:30px;">WIN</h1>
        <h2 id="popAmount" style="color:gold;">+ 0</h2>
        <button class="btn-play" onclick="closePopup()">í™•ì¸</button>
    </div>

    <div class="top-nav">
        <div class="logo" onclick="showView('lobby')">S SUPER 9 BET</div>
        <div class="nav-right">
            <div class="asset-box">â‚© <span id="assetVal">0</span></div>
            <div class="user-menu">
                <span onclick="handleLogout()" style="color:#ff5252;">ë¡œê·¸ì•„ì›ƒ</span>
            </div>
        </div>
    </div>

    <div class="main-wrapper">
        <div class="sidebar">
            <div id="m-lobby" class="menu-item menu-active" onclick="showView('lobby')">ë©”ì¸ ë¡œë¹„</div>
            <div id="m-slotView" class="menu-item" onclick="showView('slotView')">777ìŠ¬ë¡¯</div>
            <div id="m-bacView" class="menu-item" onclick="showView('bacView')">ë°”ì¹´ë¼</div>
            <div id="m-snailView" class="menu-item" onclick="showView('snailView')">ë‹¬íŒ½ì´ ë ˆì´ìŠ¤</div>
            <div id="m-csCenter" class="menu-item" onclick="showView('csCenter')">ê³ ê°ì„¼í„°</div>
            <div id="m-myPage" class="menu-item" onclick="showView('myPage')">ë§ˆì´í˜ì´ì§€</div>
            
            <div class="rule-box">
                <h4>ğŸ“œ ì´ìš© ê·œì •</h4>
                <b>[ ìŠ¬ë¡¯ ]</b>
                â€¢ 777: <span>17.7ë°°</span><br>
                â€¢ í˜ì–´: <span>1.5ë°°</span>
                <b>[ ë°”ì¹´ë¼ ]</b>
                â€¢ P/B: <span>2.5ë°°</span><br>
                â€¢ TIE: <span>9.0ë°°</span>
            </div>

            <div class="side-ad">
                <div class="mini-ad" style="background: #00ff00; color: #000;">ğŸ’¸ ì•ˆì „ ë†€ì´í„° ğŸ’¸</div>
            </div>
        </div>

        <div class="content">
            <div class="ad-row">
                <div class="ad-box" style="background:red; color:yellow; border-color: yellow;">ğŸ”¥ ë³´ì¦ì—…ì²´ ë©”ì´ì € ğŸ”¥</div>
                <div class="ad-box" style="background:blue; color:white; border-color: cyan;">ğŸ’ ê°„í¸ ê°€ì… ğŸ’</div>
            </div>

            <div id="lobby" class="view active-view">
                <div class="game-panel">
                    <h1 style="color:gold; font-size: 28px; margin-bottom: 10px;">SUPER 000 BET</h1>
                    <p style="font-size: 14px;"> ë¨¹íŠ€ ì—†ëŠ” ê³ ë°°ë‹¹ ì•ˆì „ ì‚¬ì´íŠ¸ </p>
                </div>
                <div class="banner-ad">
                    <div class="banner-text">âš¡ ì—…ê³„ ìµœê³  ë°°ë‹¹ ë³´ì¥! âš¡ LTEê¸‰ ê´‘ì† í¬ì¸íŠ¸ ì „í™˜ âš¡</div>
                </div>
            </div>

            <div id="slotView" class="view">
                <div class="game-panel">
                    <h3>ğŸ° LUCKY 777 SLOT</h3>
                    <div style="display:flex; justify-content:center; gap:5px; margin:15px;">
                        <div id="r1" style="font-size:40px; background:#fff; padding:10px; border-radius:5px; color:#000;">7ï¸âƒ£</div>
                        <div id="r2" style="font-size:40px; background:#fff; padding:10px; border-radius:5px; color:#000;">7ï¸âƒ£</div>
                        <div id="r3" style="font-size:40px; background:#fff; padding:10px; border-radius:5px; color:#000;">7ï¸âƒ£</div>
                    </div>
                    <input type="number" id="slotBet" style="background:#000; color:gold; padding:8px; border:1px solid #444; width:80%; margin-bottom:10px;" value="10000">
                    <button id="slotBtn" class="btn-play" onclick="playSlot()">SPIN!</button>
                </div>
            </div>

            <div id="bacView" class="view">
                <div class="game-panel">
                    <div class="bac-table">
                        <div id="pArea"><div id="pC1" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div><div id="pC2" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div></div>
                        <div id="bArea"><div id="bC1" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div><div id="bC2" class="card-slot"><div class="card-inner"><div class="card-back"></div><div class="card-front"></div></div></div></div>
                    </div>
                    <input type="number" id="bacBet" style="background:#000; color:gold; padding:8px; border:1px solid #444; width:80%;" value="10000">
                    <div style="margin-top:10px;"><button class="btn-play" style="background:#4facfe;" onclick="playBac('player')">P</button> <button class="btn-play" style="background:#4caf50;" onclick="playBac('tie')">T</button> <button class="btn-play" style="background:#ff5252;" onclick="playBac('banker')">B</button></div>
                </div>
            </div>

            <div id="snailView" class="view">
                <div class="game-panel">
                    <h3>ğŸŒ SNAIL RACING</h3>
                    <canvas id="snailCanvas" width="600" height="200" style="background:#222;"></canvas>
                    <div style="margin:10px; font-size:12px;"><label><input type="radio" name="snailPick" value="0" checked>1ë²ˆ</label> <label><input type="radio" name="snailPick" value="1">2ë²ˆ</label> <label><input type="radio" name="snailPick" value="2">3ë²ˆ</label></div>
                    <input type="number" id="snailBet" style="background:#000; color:gold; padding:8px; width:80%;" value="10000">
                    <button id="snailBtn" class="btn-play" onclick="playSnail()">RACE!</button>
                </div>
            </div>

            <div id="csCenter" class="view">
                <div class="game-panel" style="text-align:left;">
                    <h3 style="color:gold;">ğŸ§ ê³ ê°ì„¼í„° <span id="adminBadge" style="display:none;">[ADM]</span></h3>
                    <input type="text" id="csTitle" placeholder="ì œëª©" style="width:100%; padding:8px; margin-bottom:5px; background:#111; color:#fff; border:1px solid #333;">
                    <textarea id="csContent" style="width:100%; height:60px; background:#111; color:#fff; border:1px solid #333; padding:8px;"></textarea>
                    <button class="btn-play" style="width:100%; margin-top:5px;" onclick="writeCS()">ë“±ë¡</button>
                    <table class="cs-list"><tbody id="csList"></tbody></table>
                </div>
            </div>

            <div id="myPage" class="view">
                <div class="game-panel" style="text-align:left;">
                    <h3>ğŸ‘¤ ë‚´ ì •ë³´</h3>
                    <p id="userInfo" style="font-size:12px;"></p>
                    <div id="historyList" style="background:#000; padding:10px; border-radius:10px; font-size:11px; max-height:300px; overflow-y:auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, increment, collection, addDoc, getDocs, query, orderBy, deleteDoc, limit } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyDOVJtg5lxJTBP2Vm1mzbuecKu9Rg-I4k4", authDomain: "gambling-23339.firebaseapp.com", projectId: "gambling-23339", storageBucket: "gambling-23339.firebasestorage.app", messagingSenderId: "1031894079454", appId: "1:1031894079454:web:960ca0f1748493cdd9af4f" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userObj = null, isAdmin = false, curBal = 0;

        onAuthStateChanged(auth, async (user) => {
            if(user) {
                userObj = user;
                const snap = await getDoc(doc(db, "users", user.uid));
                if(snap.exists()) {
                    const data = snap.data();
                    isAdmin = data.role === 'admin';
                    if(isAdmin) document.getElementById('adminBadge').style.display = 'inline';
                    document.getElementById('assetVal').innerText = data.balance.toLocaleString();
                    document.getElementById('userInfo').innerText = `ID: ${user.email} / Nick: ${data.nickname || "User"}`;
                    curBal = data.balance;
                }
            } else { location.href = "login.html"; }
        });

        async function processBet(gameName, bet, profit) {
            const newBal = curBal + profit;
            await updateDoc(doc(db, "users", userObj.uid), { balance: increment(profit) });
            document.getElementById('assetVal').innerText = newBal.toLocaleString();
            curBal = newBal;
            await addDoc(collection(db, "history"), { uid: userObj.uid, game: gameName, bet: bet, profit: profit, time: new Date() });
        }

        const emojis = ['7ï¸âƒ£', 'ğŸ’', 'ğŸ’', 'ğŸ‹', 'ğŸ‡'];
        window.playSlot = async () => {
            const bet = parseInt(document.getElementById('slotBet').value);
            if(bet > curBal) return alert("ì”ì•¡ë¶€ì¡±");
            let count = 0;
            const iv = setInterval(() => {
                document.getElementById('r1').innerText = emojis[Math.floor(Math.random()*5)];
                document.getElementById('r2').innerText = emojis[Math.floor(Math.random()*5)];
                document.getElementById('r3').innerText = emojis[Math.floor(Math.random()*5)];
                if(++count > 15) {
                    clearInterval(iv);
                    const r = [document.getElementById('r1').innerText, document.getElementById('r2').innerText, document.getElementById('r3').innerText];
                    let mul = 0;
                    const sevens = r.filter(v => v === '7ï¸âƒ£').length;
                    if (sevens === 3) mul = 17.7;
                    else if (sevens === 2) mul = 2.7;
                    else if (r[0]===r[1] || r[1]===r[2] || r[0]===r[2]) mul = 1.5;
                    const profit = (bet * mul) - bet;
                    processBet("ìŠ¬ë¡¯", bet, profit); showPopup(profit>=0, profit);
                }
            }, 100);
        };

        window.playBac = async (pick) => {
            const bet = parseInt(document.getElementById('bacBet').value);
            if(bet > curBal) return alert("ì”ì•¡ë¶€ì¡±");
            const getC = () => ({ v: Math.floor(Math.random()*10), url: `https://deckofcardsapi.com/static/img/back.png` });
            const c = [getC(), getC(), getC(), getC()];
            const pS = (c[0].v + c[2].v)%10, bS = (c[1].v + c[3].v)%10;
            const win = pS > bS ? 'player' : (bS > pS ? 'banker' : 'tie');
            let profit = (pick === win) ? (win === 'tie' ? bet * 9 : bet * 2.5) - bet : -bet;
            processBet("ë°”ì¹´ë¼", bet, profit); showPopup(profit>0, profit);
        };

        let snX = [10, 10, 10];
        window.initSnail = () => {
            const ctx = document.getElementById('snailCanvas').getContext('2d');
            function frame() {
                ctx.clearRect(0,0,600,200);
                snX.forEach((x, i) => { ctx.fillStyle="white"; ctx.font="30px Arial"; ctx.fillText("ğŸŒ", x, 50 + (i*60)); });
                if(document.getElementById('snailView').classList.contains('active-view')) requestAnimationFrame(frame);
            }
            frame();
        };
        window.playSnail = async () => {
            const bet = parseInt(document.getElementById('snailBet').value), pick = parseInt(document.querySelector('input[name="snailPick"]:checked').value);
            if(bet > curBal) return alert("ì”ì•¡ë¶€ì¡±");
            const iv = setInterval(() => {
                let win = -1;
                snX = snX.map((x, i) => { const nx = x + Math.random()*10; if(nx > 500) win = i; return nx; });
                if(win !== -1) {
                    clearInterval(iv);
                    const p = (win === pick) ? (bet * 2.8) - bet : -bet;
                    processBet("ë‹¬íŒ½ì´", bet, p); showPopup(p>0, p); snX = [10,10,10];
                }
            }, 50);
        };

        window.writeCS = async () => {
            const t = document.getElementById('csTitle').value, c = document.getElementById('csContent').value;
            if(!t || !c) return;
            await addDoc(collection(db, "cs"), { uid: userObj.uid, email: userObj.email, title: t, content: c, time: new Date() });
            alert("ë“±ë¡ì™„ë£Œ"); loadCS();
        };
        async function loadCS() {
            const q = query(collection(db, "cs"), orderBy("time", "desc"), limit(10));
            const snap = await getDocs(q);
            document.getElementById('csList').innerHTML = snap.docs.map(d => `<tr><td>${d.data().title}</td><td>${d.data().email.split('@')[0]}</td></tr>`).join('');
        }

        window.showView = (v) => {
            document.querySelectorAll('.view').forEach(e => e.classList.remove('active-view'));
            document.querySelectorAll('.menu-item').forEach(e => e.classList.remove('menu-active'));
            document.getElementById(v).classList.add('active-view');
            document.getElementById('m-' + v).classList.add('menu-active');
            if(v === 'snailView') initSnail();
            if(v === 'csCenter') loadCS();
        };

        window.showPopup = (win, am) => {
            document.getElementById('popTitle').innerText = win ? "WIN!" : "LOSE";
            document.getElementById('popAmount').innerText = am.toLocaleString() + " KRW";
            document.getElementById('resultPopup').style.display = 'block';
        };
        window.closePopup = () => document.getElementById('resultPopup').style.display = 'none';
        window.handleLogout = () => signOut(auth).then(() => location.href="login.html");
    </script>
</body>
</html>